<style>
  #result {
    margin-top: 2em;
    padding: 1em 0;
    white-space: normal;
    box-sizing: border-box;
    font-size: 1em;
    color: #333;
    line-height: 1.5;
    text-align: left;
  }
</style>

<script>
  function calculateOptimal() {
    const currentItems = parseInt(document.getElementById('currentItems').value);
    const availableStamina = parseInt(document.getElementById('availableStamina').value);

    if (isNaN(currentItems) || isNaN(availableStamina) || currentItems < 0 || availableStamina < 0) {
      document.getElementById('result').innerHTML =
        '<span style="color: red; font-weight: bold;">âš ï¸ ã‚¢ã‚¤ãƒ†ãƒ æ•°ã¨ã‚¹ã‚¿ãƒŸãƒŠæ•°ã«æ­£ã—ã„æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</span>';
      return;
    }

    const goal = 2000;
    const neededItems = goal - currentItems;
    let resultHtml = '';

    if (neededItems <= 0) {
      resultHtml = `<div class="status-header" style="color: green;">ğŸ‰ ç›®æ¨™ã‚¢ã‚¤ãƒ†ãƒ æ•°(${goal}å€‹)ã¯æ—¢ã«é”æˆã—ã¦ã„ã¾ã™ï¼</div>`;
      document.getElementById('result').innerHTML = resultHtml;
      return;
    }

    const STAMINA_COST = 21;
    const DROP_A = 10;
    const DROP_B = 3;

    let minTotalCount = Infinity;
    let finalMinACount = -1;
    let finalMinBCount = -1;

    const A_max_needed = Math.ceil(neededItems / DROP_A);

    for (let a = 0; a <= A_max_needed; a++) {
      const remainingItems = neededItems - a * DROP_A;
      const b = remainingItems <= 0 ? 0 : Math.ceil(remainingItems / DROP_B);
      const totalCount = a + b;

      if (totalCount < minTotalCount) {
        minTotalCount = totalCount;
        finalMinACount = a;
        finalMinBCount = b;
      }
    }

    const minStaminaCost = minTotalCount * STAMINA_COST;
    const totalItemsAchieved = finalMinACount * DROP_A + finalMinBCount * DROP_B;

    if (minStaminaCost > availableStamina) {
      const shortage = minStaminaCost - availableStamina;
      resultHtml = `
<div class="status-header" style="color: red;">âŒ ã‚¹ã‚¿ãƒŸãƒŠä¸è¶³ã§ç›®æ¨™é”æˆä¸å¯</div>
ç›®æ¨™é”æˆã«å¿…è¦ãªæœ€å°å›æ•° ${minTotalCount}å›åˆ†ã®ã‚¹ã‚¿ãƒŸãƒŠã¯ ${minStaminaCost} ã§ã™ã€‚
ã‚ã¨ <strong>${shortage}</strong> ã‚¹ã‚¿ãƒŸãƒŠãŒå¿…è¦ã§ã™ã€‚
`;
    } else {
      const remainingStamina = availableStamina - minStaminaCost;
      resultHtml = `
<div class="status-header" style="color: green;">âœ… ç›®æ¨™é”æˆå¯èƒ½ï¼ˆæœ€å°å›æ•°ï¼‰</div>
<span class="min-count-line">2000å€‹é”æˆã®ãŸã‚ã«ã€Aã‚®ãƒ£ã‚¶ãƒ¼ã¯æœ€ä½ <strong>${finalMinACount}å›</strong> å‚åŠ ãŒå¿…è¦ã§ã™ã€‚</span>
<span class="details-header">ğŸ”¸ å†…è¨³ï¼ˆæœ€å°ã‚¹ã‚¿ãƒŸãƒŠ ${minStaminaCost} ã§é”æˆï¼‰:</span>
<ul>
<li>ãƒ»Aã‚®ãƒ£ã‚¶ãƒ¼ (ãƒ‰ãƒ­ãƒƒãƒ—10): ${finalMinACount}å›</li>
<li>ãƒ»Bã‚®ãƒ£ã‚¶ãƒ¼ (ãƒ‰ãƒ­ãƒƒãƒ—3): ${finalMinBCount}å›</li>
<li>ãƒ»åˆè¨ˆã‚¢ã‚¤ãƒ†ãƒ : ${totalItemsAchieved}å€‹</li>
<li>ãƒ»åˆè¨ˆæ¶ˆè²»ã‚¹ã‚¿ãƒŸãƒŠ: ${minStaminaCost} (æ®‹ã‚Šã‚¹ã‚¿ãƒŸãƒŠ: ${remainingStamina})</li>
</ul>
`;
    }

    document.getElementById('result').innerHTML = resultHtml;
  }

  document.addEventListener('DOMContentLoaded', calculateOptimal);
  document.getElementById('currentItems').addEventListener('input', calculateOptimal);
  document.getElementById('availableStamina').addEventListener('input', calculateOptimal);
</script>
